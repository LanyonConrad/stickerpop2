<!DOCTYPE html>
<html>

<head>
    <title>Stickerpop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body style="padding: 0; margin: 0">

    <!-- <script type="text/javascript">
        (async function () {

            // const data = { "url": "https://cdn.motor1.com/images/mgl/QeWez9/s1/001.webp" }
            const data = { "url": "https://previews.123rf.com/images/javiindy/javiindy1609/javiindy160900011/62772378-multiracial-group-of-friends-taking-selfie-in-a-urban-park.jpg" }
            // const data = { "url": "https://assets.capitalxtra.com/2016/20/kanye-west-poses-against-red-ferrari-on-lunch-date-with-kim-and-north-1463395662-view-0.jpeg" }
            // const data = { "url": "https://d1iweu5ycuvvev.cloudfront.net/powernationtv-com/media/uploads/2023/08/rental-ferrari-teen-1024x576.jpg" }

            try {
                const response = await fetch("https://bgremover.cognitiveservices.azure.com/computervision/imageanalysis:segment?api-version=2023-02-01-preview&mode=backgroundRemoval", {
                    method: "POST", // or 'PUT'
                    headers: {
                        "Content-Type": "application/json",
                        "Ocp-Apim-Subscription-Key": "925b5b702e414bcbac41a61457e83875"
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.blob();
                // console.log("Success:", result);
                const image = document.querySelector('.my-image');
                const objectURL = URL.createObjectURL(result);
                image.src = objectURL;
            } catch (error) {
                console.error("Error:", error);
            }

        })();


    </script> -->
    <!-- <div style="display: flex; background-color: orange; height: 70px; justify-content: center; align-items: center;">
        <img class="my-image" style="height: 100%;" />
    </div>
    <div id="paste-button">paste</div> -->

    <header style="display: flex; justify-content: center; align-items: center; height: 70px; font-family: Arial; font-size: 24px; font-weight: bold;">
        Stickerpop
    </header>

    <input type="file" name="file" id="file" class="myclass" />

    <label for="file" id="uploader" ondrop="drop(event)" ondragenter="dragEnter(event)"
        ondragleave="dragLeave(event)" ondragover="allowDrop(event)"
        style="display: flex; width: 100vw; height: 140vw; background-color: #f0f9ff; padding: 16px; box-sizing: border-box;">
        <span class="uploaderBox" style="pointer-events: none; display: flex; height:100%; justify-content: center; align-items: center;">
            asdf
        </span>
    </label>

    <canvas id="canvas" width="300" height="300" style="border: 2px solid gold"></canvas>

    <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
    <script>
        var canvas = new fabric.Canvas('canvas');

        var rect = new fabric.Rect({
            top : 100,
            left : 100,
            width : 60,
            height : 70,
            fill : 'red'
        });

        canvas.add(rect);
    </script>

    <script>
        const pasteButton = document.querySelector('#paste-button');

        console.log(pasteButton)

        pasteButton.addEventListener('click', async () => {
            /* try {
                const clipboardItems = await navigator.clipboard.read();
                for (const clipboardItem of clipboardItems) {
                    const imageTypes = clipboardItem.types.find(type => type.startsWith('image/'))
                    for (const imageType of imageTypes) {
                        console.log(imageType)
                        const blob = await clipboardItem.getType(imageType);
                        // Do something with the image blob.
                        const image = document.querySelector('.my-image');
                        const objectURL = URL.createObjectURL(blob);
                        image.src = objectURL;
                    }
                }
            } catch (err) {
                console.error(err.name, err.message);
            } */

            try {
                const clipboardContents = await navigator.clipboard.read();
                console.log("asdf")
                for (const item of clipboardContents) {
                    if (!item.types.includes("image/jpeg")) {
                        throw new Error("Clipboard does not contain PNG image data.");
                    }
                    const blob = await item.getType("image/png");
                    console.log(blob)
                    const image = document.querySelector('.my-image');
                    const objectURL = URL.createObjectURL(blob);
                    image.src = objectURL;
                }
            } catch (error) {
                console.log(error.message);
            }

            document.addEventListener("paste", (event) => {
                /* the session has shut down */
                console.log("asdf")
            });
        });
    </script>
    <script>

        function dragEnter(event) {
            document.querySelector("#uploader").style.backgroundColor = "lightblue";
        }

        function dragLeave(event) {
            document.querySelector("#uploader").style.backgroundColor = "#f0f9ff";
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event) {
            event.preventDefault();
            document.querySelector("#uploader").style.backgroundColor = "#f0f9ff";
        }
    </script>
</body>

<style>


    #uploader {
        transition: background .5s;
        font-size: 2em;
        font-weight: 700;
        color: white;
    }

    .uploaderBox {
        width: 100%;
        height: 100%;
        background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='10' ry='10' stroke='black' stroke-width='4' stroke-dasharray='6%2c 14' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        border-radius: 10px;
        /* strange, can't have transparent background, because sometimes bottom border will be rendered thin on chrome ?!? */
        background-color: #ffffff01;
    }

    .myclass {
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        overflow: hidden;
        position: absolute;
        z-index: -1;
    }

    /* .myclass+label {
        font-size: 2em;
        font-weight: 700;
        color: white;
        background-color: transparent;
        border-radius: 10px;
        display: inline-block;
    } */

    /* .myclass:focus+label,
    .myclass+label:hover {
        background-color: rgba(128, 0, 128, 0.322);
    } */
</style>

</html>

<!-- const image = document.querySelector('.my-image');
fetch('flowers.jpg')
.then(response => response.blob())
.then(blob => {
  const objectURL = URL.createObjectURL(blob);
  image.src = objectURL;
}); -->